kind: remote
metadata:
  name: model-monitoring-stream
  tag: ''
  hash: ad4242f0317bd3093a425bbd5efd405166d2710a
  project: default
  categories: []
spec:
  command: ''
  args: []
  image: mlrun/mlrun
  description: ''
  min_replicas: 1
  max_replicas: 4
  env: []
  base_spec: ''
  source: ''
  build:
    functionSourceCode: aW1wb3J0IGpzb24KZnJvbSBjb2xsZWN0aW9ucyBpbXBvcnQgZGVmYXVsdGRpY3QKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKZnJvbSBvcyBpbXBvcnQgZW52aXJvbgpmcm9tIHR5cGluZyBpbXBvcnQgRGljdCwgTGlzdCwgU2V0LCBPcHRpb25hbCwgQW55LCBVbmlvbgoKaW1wb3J0IHBhbmRhcyBhcyBwZApmcm9tIG1scnVuLmNvbmZpZyBpbXBvcnQgY29uZmlnCmZyb20gbWxydW4ucnVuIGltcG9ydCBNTENsaWVudEN0eApmcm9tIG1scnVuLnV0aWxzIGltcG9ydCBsb2dnZXIKZnJvbSBtbHJ1bi51dGlscy5tb2RlbF9tb25pdG9yaW5nIGltcG9ydCAoCiAgICBwYXJzZV9tb2RlbF9lbmRwb2ludF9zdG9yZV9wcmVmaXgsCiAgICBjcmVhdGVfbW9kZWxfZW5kcG9pbnRfaWQsCikKZnJvbSBtbHJ1bi51dGlscy52M2lvX2NsaWVudHMgaW1wb3J0IGdldF92M2lvX2NsaWVudCwgZ2V0X2ZyYW1lc19jbGllbnQKZnJvbSBudWNsaW8gaW1wb3J0IEV2ZW50CmZyb20gc3RvcmV5IGltcG9ydCAoCiAgICBGaWVsZEFnZ3JlZ2F0b3IsCiAgICBOb29wRHJpdmVyLAogICAgVGFibGUsCiAgICBTb3VyY2UsCiAgICBNYXAsCiAgICBNYXBDbGFzcywKICAgIEFnZ3JlZ2F0ZUJ5S2V5LAogICAgYnVpbGRfZmxvdywKICAgIFdyaXRlVG9QYXJxdWV0LAogICAgRmlsdGVyLAogICAgV3JpdGVUb1RTREIsCiAgICBGbGF0TWFwLAopCmZyb20gc3RvcmV5LmR0eXBlcyBpbXBvcnQgU2xpZGluZ1dpbmRvd3MKZnJvbSBzdG9yZXkuc3RlcHMgaW1wb3J0IFNhbXBsZVdpbmRvdwoKIyBDb25zdGFudHMKSVNPXzgwNjFfVVRDID0gIiVZLSVtLSVkICVIOiVNOiVTLiVmJXoiCkZVTkNUSU9OX1VSSSA9ICJmdW5jdGlvbl91cmkiCk1PREVMID0gIm1vZGVsIgpWRVJTSU9OID0gInZlcnNpb24iClZFUlNJT05FRF9NT0RFTCA9ICJ2ZXJzaW9uZWRfbW9kZWwiCk1PREVMX0NMQVNTID0gIm1vZGVsX2NsYXNzIgpUSU1FU1RBTVAgPSAidGltZXN0YW1wIgpFTkRQT0lOVF9JRCA9ICJlbmRwb2ludF9pZCIKUkVRVUVTVF9JRCA9ICJyZXF1ZXN0X2lkIgpMQUJFTFMgPSAibGFiZWxzIgpVTlBBQ0tFRF9MQUJFTFMgPSAidW5wYWNrZWRfbGFiZWxzIgpMQVRFTkNZX0FWR181TSA9ICJsYXRlbmN5X2F2Z181bSIKTEFURU5DWV9BVkdfMUggPSAibGF0ZW5jeV9hdmdfMWgiClBSRURJQ1RJT05TX1BFUl9TRUNPTkQgPSAicHJlZGljdGlvbnNfcGVyX3NlY29uZCIKUFJFRElDVElPTlNfQ09VTlRfNU0gPSAicHJlZGljdGlvbnNfY291bnRfNW0iClBSRURJQ1RJT05TX0NPVU5UXzFIID0gInByZWRpY3Rpb25zX2NvdW50XzFoIgpGSVJTVF9SRVFVRVNUID0gImZpcnN0X3JlcXVlc3QiCkxBU1RfUkVRVUVTVCA9ICJsYXN0X3JlcXVlc3QiCkVSUk9SX0NPVU5UID0gImVycm9yX2NvdW50IgpFTlRJVElFUyA9ICJlbnRpdGllcyIKRkVBVFVSRV9OQU1FUyA9ICJmZWF0dXJlX25hbWVzIgpMQUJFTF9DT0xVTU5TID0gImxhYmVsX2NvbHVtbnMiCkxBVEVOQ1kgPSAibGF0ZW5jeSIKUkVDT1JEX1RZUEUgPSAicmVjb3JkX3R5cGUiCkZFQVRVUkVTID0gImZlYXR1cmVzIgpQUkVESUNUSU9OID0gInByZWRpY3Rpb24iClBSRURJQ1RJT05TID0gInByZWRpY3Rpb25zIgpOQU1FRF9GRUFUVVJFUyA9ICJuYW1lZF9mZWF0dXJlcyIKTkFNRURfUFJFRElDVElPTlMgPSAibmFtZWRfcHJlZGljdGlvbnMiCkJBU0VfTUVUUklDUyA9ICJiYXNlX21ldHJpY3MiCkNVU1RPTV9NRVRSSUNTID0gImN1c3RvbV9tZXRyaWNzIgpFTkRQT0lOVF9GRUFUVVJFUyA9ICJlbmRwb2ludF9mZWF0dXJlcyIKTUVUUklDUyA9ICJtZXRyaWNzIgpCQVRDSF9USU1FU1RBTVAgPSAiYmF0Y2hfdGltZXN0YW1wIgpUSU1FX0ZPUk1BVDogc3RyID0gIiVZLSVtLSVkICVIOiVNOiVTLiVmIiAgIyBJU08gODA2MQoKCiMgU3RyZWFtIHByb2Nlc3NpbmcgY29kZQpjbGFzcyBFdmVudFN0cmVhbVByb2Nlc3NvcjoKICAgIGRlZiBfX2luaXRfXygKICAgICAgICBzZWxmLAogICAgICAgIHByb2plY3Q6IHN0ciwKICAgICAgICBzYW1wbGVfd2luZG93OiBpbnQgPSAxMCwKICAgICAgICB0c2RiX2JhdGNoaW5nX21heF9ldmVudHM6IGludCA9IDEwLAogICAgICAgIHRzZGJfYmF0Y2hpbmdfdGltZW91dF9zZWNzOiBpbnQgPSA2MCAqIDUsICAjIERlZmF1bHQgNSBtaW51dGVzCiAgICAgICAgcGFycXVldF9iYXRjaGluZ19tYXhfZXZlbnRzOiBpbnQgPSAxMF8wMDAsCiAgICAgICAgcGFycXVldF9iYXRjaGluZ190aW1lb3V0X3NlY3M6IGludCA9IDYwICogNjAsICAjIERlZmF1bHQgMSBob3VyCiAgICAgICAgYWdncmVnYXRlX2NvdW50X3dpbmRvd3M6IE9wdGlvbmFsW0xpc3Rbc3RyXV0gPSBOb25lLAogICAgICAgIGFnZ3JlZ2F0ZV9jb3VudF9wZXJpb2Q6IHN0ciA9ICIzMHMiLAogICAgICAgIGFnZ3JlZ2F0ZV9hdmdfd2luZG93czogT3B0aW9uYWxbTGlzdFtzdHJdXSA9IE5vbmUsCiAgICAgICAgYWdncmVnYXRlX2F2Z19wZXJpb2Q6IHN0ciA9ICIzMHMiLAogICAgICAgIHYzaW9fYWNjZXNzX2tleTogT3B0aW9uYWxbc3RyXSA9IE5vbmUsCiAgICAgICAgdjNpb19mcmFtZXNkOiBPcHRpb25hbFtzdHJdID0gTm9uZSwKICAgICk6CiAgICAgICAgc2VsZi5wcm9qZWN0ID0gcHJvamVjdAogICAgICAgIHNlbGYuc2FtcGxlX3dpbmRvdyA9IHNhbXBsZV93aW5kb3cKICAgICAgICBzZWxmLnRzZGJfYmF0Y2hpbmdfbWF4X2V2ZW50cyA9IHRzZGJfYmF0Y2hpbmdfbWF4X2V2ZW50cwogICAgICAgIHNlbGYudHNkYl9iYXRjaGluZ190aW1lb3V0X3NlY3MgPSB0c2RiX2JhdGNoaW5nX3RpbWVvdXRfc2VjcwogICAgICAgIHNlbGYucGFycXVldF9iYXRjaGluZ19tYXhfZXZlbnRzID0gcGFycXVldF9iYXRjaGluZ19tYXhfZXZlbnRzCiAgICAgICAgc2VsZi5wYXJxdWV0X2JhdGNoaW5nX3RpbWVvdXRfc2VjcyA9IHBhcnF1ZXRfYmF0Y2hpbmdfdGltZW91dF9zZWNzCiAgICAgICAgc2VsZi5hZ2dyZWdhdGVfY291bnRfd2luZG93cyA9IGFnZ3JlZ2F0ZV9jb3VudF93aW5kb3dzIG9yIFsiNW0iLCAiMWgiXQogICAgICAgIHNlbGYuYWdncmVnYXRlX2NvdW50X3BlcmlvZCA9IGFnZ3JlZ2F0ZV9jb3VudF9wZXJpb2QKICAgICAgICBzZWxmLmFnZ3JlZ2F0ZV9hdmdfd2luZG93cyA9IGFnZ3JlZ2F0ZV9hdmdfd2luZG93cyBvciBbIjVtIiwgIjFoIl0KICAgICAgICBzZWxmLmFnZ3JlZ2F0ZV9hdmdfcGVyaW9kID0gYWdncmVnYXRlX2F2Z19wZXJpb2QKICAgICAgICBzZWxmLnYzaW9fYWNjZXNzX2tleSA9IHYzaW9fYWNjZXNzX2tleSBvciBlbnZpcm9uLmdldCgiVjNJT19BQ0NFU1NfS0VZIikKICAgICAgICBzZWxmLnYzaW9fZnJhbWVzZCA9IHYzaW9fZnJhbWVzZCBvciBjb25maWcudjNpb19mcmFtZXNkCgogICAgICAgIHRlbXBsYXRlID0gY29uZmlnLm1vZGVsX2VuZHBvaW50X21vbml0b3Jpbmcuc3RvcmVfcHJlZml4ZXMuZGVmYXVsdAoKICAgICAgICBrdl9wYXRoID0gdGVtcGxhdGUuZm9ybWF0KHByb2plY3Q9cHJvamVjdCwga2luZD0iZW5kcG9pbnRzIikKICAgICAgICBfLCBzZWxmLmt2X2NvbnRhaW5lciwgc2VsZi5rdl9wYXRoID0gcGFyc2VfbW9kZWxfZW5kcG9pbnRfc3RvcmVfcHJlZml4KGt2X3BhdGgpCgogICAgICAgIHRzZGJfcGF0aCA9IHRlbXBsYXRlLmZvcm1hdChwcm9qZWN0PXByb2plY3QsIGtpbmQ9ImV2ZW50cyIpCiAgICAgICAgXywgc2VsZi50c2RiX2NvbnRhaW5lciwgc2VsZi50c2RiX3BhdGggPSBwYXJzZV9tb2RlbF9lbmRwb2ludF9zdG9yZV9wcmVmaXgoCiAgICAgICAgICAgIHRzZGJfcGF0aAogICAgICAgICkKICAgICAgICBzZWxmLnRzZGJfcGF0aCA9IGYie3NlbGYudHNkYl9jb250YWluZXJ9L3tzZWxmLnRzZGJfcGF0aH0iCgogICAgICAgIHNlbGYucGFycXVldF9wYXRoID0gdGVtcGxhdGUuZm9ybWF0KHByb2plY3Q9cHJvamVjdCwga2luZD0icGFycXVldCIpCgogICAgICAgIGxvZ2dlci5pbmZvKAogICAgICAgICAgICAiV3JpdGVyIHBhdGhzIiwKICAgICAgICAgICAga3ZfcGF0aD1zZWxmLmt2X3BhdGgsCiAgICAgICAgICAgIHRzZGJfcGF0aD1zZWxmLnRzZGJfcGF0aCwKICAgICAgICAgICAgcGFycXVldF9wYXRoPXNlbGYucGFycXVldF9wYXRoLAogICAgICAgICkKCiAgICAgICAgc2VsZi5fa3Zfa2V5cyA9IFsKICAgICAgICAgICAgRlVOQ1RJT05fVVJJLAogICAgICAgICAgICBNT0RFTCwKICAgICAgICAgICAgTU9ERUxfQ0xBU1MsCiAgICAgICAgICAgIFRJTUVTVEFNUCwKICAgICAgICAgICAgRU5EUE9JTlRfSUQsCiAgICAgICAgICAgIExBQkVMUywKICAgICAgICAgICAgVU5QQUNLRURfTEFCRUxTLAogICAgICAgICAgICBMQVRFTkNZX0FWR181TSwKICAgICAgICAgICAgTEFURU5DWV9BVkdfMUgsCiAgICAgICAgICAgIFBSRURJQ1RJT05TX1BFUl9TRUNPTkQsCiAgICAgICAgICAgIFBSRURJQ1RJT05TX0NPVU5UXzVNLAogICAgICAgICAgICBQUkVESUNUSU9OU19DT1VOVF8xSCwKICAgICAgICAgICAgRklSU1RfUkVRVUVTVCwKICAgICAgICAgICAgTEFTVF9SRVFVRVNULAogICAgICAgICAgICBFUlJPUl9DT1VOVCwKICAgICAgICBdCgogICAgICAgIHNlbGYuX2Zsb3cgPSBidWlsZF9mbG93KAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBTb3VyY2UoKSwKICAgICAgICAgICAgICAgIFByb2Nlc3NFbmRwb2ludEV2ZW50KHNlbGYua3ZfY29udGFpbmVyLCBzZWxmLmt2X3BhdGgpLAogICAgICAgICAgICAgICAgRmlsdGVyTm90Tm9uZSgpLAogICAgICAgICAgICAgICAgRmxhdE1hcChsYW1iZGEgeDogeCksCiAgICAgICAgICAgICAgICBNYXBGZWF0dXJlTmFtZXMoc2VsZi5rdl9jb250YWluZXIsIHNlbGYua3ZfcGF0aCksCiAgICAgICAgICAgICAgICAjIEJyYW5jaCAxOiBBZ2dyZWdhdGUgZXZlbnRzLCBjb3VudCBhdmVyYWdlcyBhbmQgdXBkYXRlIFRTREIgYW5kIEtWCiAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgQWdncmVnYXRlQnlLZXkoCiAgICAgICAgICAgICAgICAgICAgICAgIGFnZ3JlZ2F0ZXM9WwogICAgICAgICAgICAgICAgICAgICAgICAgICAgRmllbGRBZ2dyZWdhdG9yKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBSRURJQ1RJT05TLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVORFBPSU5UX0lELAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsiY291bnQiXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTbGlkaW5nV2luZG93cygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZ2dyZWdhdGVfY291bnRfd2luZG93cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZ2dyZWdhdGVfY291bnRfcGVyaW9kLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRmllbGRBZ2dyZWdhdG9yKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExBVEVOQ1ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTEFURU5DWSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbImF2ZyJdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNsaWRpbmdXaW5kb3dzKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFnZ3JlZ2F0ZV9hdmdfd2luZG93cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZ2dyZWdhdGVfYXZnX3BlcmlvZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgICAgICAgdGFibGU9VGFibGUoIm5vdGFibGUiLCBOb29wRHJpdmVyKCkpLAogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgU2FtcGxlV2luZG93KAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhbXBsZV93aW5kb3cKICAgICAgICAgICAgICAgICAgICApLCAgIyBBZGQgcmVxdWlyZWQgZ2FwIGJldHdlZW4gZXZlbnQgdG8gYXBwbHkgc2FtcGxpbmcKICAgICAgICAgICAgICAgICAgICBNYXAoc2VsZi5jb21wdXRlX3ByZWRpY3Rpb25zX3Blcl9zZWNvbmQpLAogICAgICAgICAgICAgICAgICAgICMgQnJhbmNoIDEuMTogVXBkYXRlZCBLVgogICAgICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAgICAgTWFwKHNlbGYucHJvY2Vzc19iZWZvcmVfa3YpLAogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZVRvS1YoY29udGFpbmVyPXNlbGYua3ZfY29udGFpbmVyLCB0YWJsZT1zZWxmLmt2X3BhdGgpLAogICAgICAgICAgICAgICAgICAgICAgICBJbmZlclNjaGVtYSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYzaW9fYWNjZXNzX2tleT1zZWxmLnYzaW9fYWNjZXNzX2tleSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYzaW9fZnJhbWVzZD1zZWxmLnYzaW9fZnJhbWVzZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcj1zZWxmLmt2X2NvbnRhaW5lciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlPXNlbGYua3ZfcGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAgICMgQnJhbmNoIDEuMjogVXBkYXRlIFRTREIKICAgICAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgICAgICMgTWFwIHRoZSBldmVudCBpbnRvIHRhZ2dhYmxlIGZpZWxkcywgYWRkIHJlY29yZCB0eXBlIHRvIGVhY2ggZmllbGQKICAgICAgICAgICAgICAgICAgICAgICAgTWFwKHNlbGYucHJvY2Vzc19iZWZvcmVfZXZlbnRzX3RzZGIpLAogICAgICAgICAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGaWx0ZXJLZXlzKEJBU0VfTUVUUklDUyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVbnBhY2tWYWx1ZXMoQkFTRV9NRVRSSUNTKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlVG9UU0RCKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg9c2VsZi50c2RiX3BhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmF0ZT0iMTAvbSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZV9jb2w9VElNRVNUQU1QLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcj1zZWxmLnRzZGJfY29udGFpbmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY2Vzc19rZXk9c2VsZi52M2lvX2FjY2Vzc19rZXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdjNpb19mcmFtZXM9c2VsZi52M2lvX2ZyYW1lc2QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXhfY29scz1bRU5EUE9JTlRfSUQsIFJFQ09SRF9UWVBFXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFNldHRpbmdzIGZvciBfQmF0Y2hpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhfZXZlbnRzPXNlbGYudHNkYl9iYXRjaGluZ19tYXhfZXZlbnRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXRfc2Vjcz1zZWxmLnRzZGJfYmF0Y2hpbmdfdGltZW91dF9zZWNzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleT1FTkRQT0lOVF9JRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpbHRlcktleXMoRU5EUE9JTlRfRkVBVFVSRVMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVW5wYWNrVmFsdWVzKEVORFBPSU5UX0ZFQVRVUkVTKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlVG9UU0RCKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg9c2VsZi50c2RiX3BhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmF0ZT0iMTAvbSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZV9jb2w9VElNRVNUQU1QLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcj1zZWxmLnRzZGJfY29udGFpbmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY2Vzc19rZXk9c2VsZi52M2lvX2FjY2Vzc19rZXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdjNpb19mcmFtZXM9c2VsZi52M2lvX2ZyYW1lc2QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXhfY29scz1bRU5EUE9JTlRfSUQsIFJFQ09SRF9UWVBFXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFNldHRpbmdzIGZvciBfQmF0Y2hpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhfZXZlbnRzPXNlbGYudHNkYl9iYXRjaGluZ19tYXhfZXZlbnRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXRfc2Vjcz1zZWxmLnRzZGJfYmF0Y2hpbmdfdGltZW91dF9zZWNzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleT1FTkRQT0lOVF9JRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpbHRlcktleXMoQ1VTVE9NX01FVFJJQ1MpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRmlsdGVyTm90Tm9uZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVW5wYWNrVmFsdWVzKENVU1RPTV9NRVRSSUNTKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlVG9UU0RCKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg9c2VsZi50c2RiX3BhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmF0ZT0iMTAvbSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZV9jb2w9VElNRVNUQU1QLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcj1zZWxmLnRzZGJfY29udGFpbmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY2Vzc19rZXk9c2VsZi52M2lvX2FjY2Vzc19rZXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdjNpb19mcmFtZXM9c2VsZi52M2lvX2ZyYW1lc2QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXhfY29scz1bRU5EUE9JTlRfSUQsIFJFQ09SRF9UWVBFXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFNldHRpbmdzIGZvciBfQmF0Y2hpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhfZXZlbnRzPXNlbGYudHNkYl9iYXRjaGluZ19tYXhfZXZlbnRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXRfc2Vjcz1zZWxmLnRzZGJfYmF0Y2hpbmdfdGltZW91dF9zZWNzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleT1FTkRQT0lOVF9JRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAjIEJyYW5jaCAyOiBCYXRjaCBldmVudHMsIHdyaXRlIHRvIHBhcnF1ZXQKICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICBNYXAoc2VsZi5wcm9jZXNzX2JlZm9yZV9wYXJxdWV0KSwKICAgICAgICAgICAgICAgICAgICBXcml0ZVRvUGFycXVldCgKICAgICAgICAgICAgICAgICAgICAgICAgcGF0aD1zZWxmLnBhcnF1ZXRfcGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgcGFydGl0aW9uX2NvbHM9WyIka2V5IiwgIiR5ZWFyIiwgIiRtb250aCIsICIkZGF5IiwgIiRob3VyIl0sCiAgICAgICAgICAgICAgICAgICAgICAgIGluZmVyX2NvbHVtbnNfZnJvbV9kYXRhPVRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICMgU2V0dGluZ3MgZm9yIF9CYXRjaGluZwogICAgICAgICAgICAgICAgICAgICAgICBtYXhfZXZlbnRzPXNlbGYucGFycXVldF9iYXRjaGluZ19tYXhfZXZlbnRzLAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0X3NlY3M9c2VsZi5wYXJxdWV0X2JhdGNoaW5nX3RpbWVvdXRfc2VjcywKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgXQogICAgICAgICkucnVuKCkKCiAgICBkZWYgY29uc3VtZShzZWxmLCBldmVudDogRGljdCk6CiAgICAgICAgZXZlbnRzID0gW10KICAgICAgICBpZiAiaGVhZGVycyIgaW4gZXZlbnQgYW5kICJ2YWx1ZXMiIGluIGV2ZW50OgogICAgICAgICAgICBmb3IgdmFsdWVzIGluIGV2ZW50WyJ2YWx1ZXMiXToKICAgICAgICAgICAgICAgIGV2ZW50cy5hcHBlbmQoe2s6IHYgZm9yIGssIHYgaW4gemlwKGV2ZW50WyJoZWFkZXJzIl0sIHZhbHVlcyl9KQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGV2ZW50cy5hcHBlbmQoZXZlbnQpCgogICAgICAgIGZvciBlbnJpY2hlZCBpbiBtYXAoZW5yaWNoX2V2ZW5fZGV0YWlscywgZXZlbnRzKToKICAgICAgICAgICAgaWYgZW5yaWNoZWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICBzZWxmLl9mbG93LmVtaXQoCiAgICAgICAgICAgICAgICAgICAgZW5yaWNoZWQsCiAgICAgICAgICAgICAgICAgICAga2V5PWVucmljaGVkW0VORFBPSU5UX0lEXSwKICAgICAgICAgICAgICAgICAgICBldmVudF90aW1lPWRhdGV0aW1lLnN0cnB0aW1lKGVucmljaGVkWyJ3aGVuIl0sIElTT184MDYxX1VUQyksCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwYXNzCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIGNvbXB1dGVfcHJlZGljdGlvbnNfcGVyX3NlY29uZChldmVudDogZGljdCk6CiAgICAgICAgZXZlbnRbUFJFRElDVElPTlNfUEVSX1NFQ09ORF0gPSBmbG9hdChldmVudFtQUkVESUNUSU9OU19DT1VOVF81TV0pIC8gNjAwCiAgICAgICAgcmV0dXJuIGV2ZW50CgogICAgZGVmIHByb2Nlc3NfYmVmb3JlX2t2KHNlbGYsIGV2ZW50OiBkaWN0KToKICAgICAgICAjIEZpbHRlciByZWxldmFudCBrZXlzCiAgICAgICAgZSA9IHtrOiBldmVudFtrXSBmb3IgayBpbiBzZWxmLl9rdl9rZXlzfQogICAgICAgICMgVW5wYWNrIGxhYmVscyBkaWN0aW9uYXJ5CiAgICAgICAgZSA9IHsqKmUsICoqZS5wb3AoVU5QQUNLRURfTEFCRUxTLCB7fSl9CiAgICAgICAgIyBXcml0ZSBsYWJlbHMgdG8ga3YgYXMganNvbiBzdHJpbmcgdG8gYmUgcHJlc2VudGFibGUgbGF0ZXIKICAgICAgICBlW0xBQkVMU10gPSBqc29uLmR1bXBzKGVbTEFCRUxTXSkKICAgICAgICByZXR1cm4gZQoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBwcm9jZXNzX2JlZm9yZV9ldmVudHNfdHNkYihldmVudDogRGljdCk6CiAgICAgICAgYmFzZV9maWVsZHMgPSBbVElNRVNUQU1QLCBFTkRQT0lOVF9JRF0KCiAgICAgICAgYmFzZV9ldmVudCA9IHtrOiBldmVudFtrXSBmb3IgayBpbiBiYXNlX2ZpZWxkc30KICAgICAgICBiYXNlX2V2ZW50W1RJTUVTVEFNUF0gPSBwZC50b19kYXRldGltZSgKICAgICAgICAgICAgYmFzZV9ldmVudFtUSU1FU1RBTVBdLCBmb3JtYXQ9VElNRV9GT1JNQVQKICAgICAgICApCgogICAgICAgIGJhc2VfbWV0cmljcyA9IHsKICAgICAgICAgICAgUkVDT1JEX1RZUEU6IEJBU0VfTUVUUklDUywKICAgICAgICAgICAgUFJFRElDVElPTlNfUEVSX1NFQ09ORDogZXZlbnRbUFJFRElDVElPTlNfUEVSX1NFQ09ORF0sCiAgICAgICAgICAgIFBSRURJQ1RJT05TX0NPVU5UXzVNOiBldmVudFtQUkVESUNUSU9OU19DT1VOVF81TV0sCiAgICAgICAgICAgIFBSRURJQ1RJT05TX0NPVU5UXzFIOiBldmVudFtQUkVESUNUSU9OU19DT1VOVF8xSF0sCiAgICAgICAgICAgIExBVEVOQ1lfQVZHXzVNOiBldmVudFtMQVRFTkNZX0FWR181TV0sCiAgICAgICAgICAgIExBVEVOQ1lfQVZHXzFIOiBldmVudFtMQVRFTkNZX0FWR18xSF0sCiAgICAgICAgICAgICoqYmFzZV9ldmVudCwKICAgICAgICB9CgogICAgICAgIGVuZHBvaW50X2ZlYXR1cmVzID0gewogICAgICAgICAgICBSRUNPUkRfVFlQRTogRU5EUE9JTlRfRkVBVFVSRVMsCiAgICAgICAgICAgICoqZXZlbnRbTkFNRURfUFJFRElDVElPTlNdLAogICAgICAgICAgICAqKmV2ZW50W05BTUVEX0ZFQVRVUkVTXSwKICAgICAgICAgICAgKipiYXNlX2V2ZW50LAogICAgICAgIH0KCiAgICAgICAgcHJvY2Vzc2VkID0ge0JBU0VfTUVUUklDUzogYmFzZV9tZXRyaWNzLCBFTkRQT0lOVF9GRUFUVVJFUzogZW5kcG9pbnRfZmVhdHVyZXN9CgogICAgICAgIGlmIGV2ZW50W01FVFJJQ1NdOgogICAgICAgICAgICBwcm9jZXNzZWRbQ1VTVE9NX01FVFJJQ1NdID0gewogICAgICAgICAgICAgICAgUkVDT1JEX1RZUEU6IENVU1RPTV9NRVRSSUNTLAogICAgICAgICAgICAgICAgKipldmVudFtNRVRSSUNTXSwKICAgICAgICAgICAgICAgICoqYmFzZV9ldmVudCwKICAgICAgICAgICAgfQoKICAgICAgICByZXR1cm4gcHJvY2Vzc2VkCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIHByb2Nlc3NfYmVmb3JlX3BhcnF1ZXQoZXZlbnQ6IGRpY3QpOgogICAgICAgIGRlZiBzZXRfbm9uZV9pZl9lbXB0eShfZXZlbnQ6IGRpY3QsIGtleXM6IExpc3Rbc3RyXSk6CiAgICAgICAgICAgIGZvciBrZXkgaW4ga2V5czoKICAgICAgICAgICAgICAgIGlmIG5vdCBfZXZlbnQuZ2V0KGtleSk6CiAgICAgICAgICAgICAgICAgICAgX2V2ZW50W2tleV0gPSBOb25lCgogICAgICAgIGRlZiBkcm9wX2lmX2V4aXN0cyhfZXZlbnQ6IGRpY3QsIGtleXM6IExpc3Rbc3RyXSk6CiAgICAgICAgICAgIGZvciBrZXkgaW4ga2V5czoKICAgICAgICAgICAgICAgIF9ldmVudC5wb3Aoa2V5LCBOb25lKQoKICAgICAgICBkZWYgdW5wYWNrX2lmX2V4aXN0cyhfZXZlbnQ6IGRpY3QsIGtleXM6IExpc3Rbc3RyXSk6CiAgICAgICAgICAgIGZvciBrZXkgaW4ga2V5czoKICAgICAgICAgICAgICAgIHZhbHVlID0gX2V2ZW50LmdldChrZXkpCiAgICAgICAgICAgICAgICBpZiB2YWx1ZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBfZXZlbnQgPSB7Kip2YWx1ZSwgKipldmVudH0KCiAgICAgICAgZHJvcF9pZl9leGlzdHMoZXZlbnQsIFtVTlBBQ0tFRF9MQUJFTFMsIEZFQVRVUkVTXSkKICAgICAgICB1bnBhY2tfaWZfZXhpc3RzKGV2ZW50LCBbRU5USVRJRVNdKQogICAgICAgIHNldF9ub25lX2lmX2VtcHR5KGV2ZW50LCBbTEFCRUxTLCBNRVRSSUNTLCBFTlRJVElFU10pCiAgICAgICAgcmV0dXJuIGV2ZW50CgoKY2xhc3MgUHJvY2Vzc0VuZHBvaW50RXZlbnQoTWFwQ2xhc3MpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGt2X2NvbnRhaW5lcjogc3RyLCBrdl9wYXRoOiBzdHIsICoqa3dhcmdzKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCoqa3dhcmdzKQogICAgICAgIHNlbGYua3ZfY29udGFpbmVyOiBzdHIgPSBrdl9jb250YWluZXIKICAgICAgICBzZWxmLmt2X3BhdGg6IHN0ciA9IGt2X3BhdGgKICAgICAgICBzZWxmLmZpcnN0X3JlcXVlc3Q6IERpY3Rbc3RyLCBzdHJdID0gZGljdCgpCiAgICAgICAgc2VsZi5sYXN0X3JlcXVlc3Q6IERpY3Rbc3RyLCBzdHJdID0gZGljdCgpCiAgICAgICAgc2VsZi5lcnJvcl9jb3VudDogRGljdFtzdHIsIGludF0gPSBkZWZhdWx0ZGljdChpbnQpCiAgICAgICAgc2VsZi5lbmRwb2ludHM6IFNldFtzdHJdID0gc2V0KCkKCiAgICBkZWYgZG8oc2VsZiwgZXZlbnQ6IGRpY3QpOgogICAgICAgIGZ1bmN0aW9uX3VyaSA9IGV2ZW50W0ZVTkNUSU9OX1VSSV0KICAgICAgICB2ZXJzaW9uZWRfbW9kZWwgPSBldmVudFtWRVJTSU9ORURfTU9ERUxdCiAgICAgICAgZW5kcG9pbnRfaWQgPSBldmVudFtFTkRQT0lOVF9JRF0KCiAgICAgICAgIyBJbiBjYXNlIHRoaXMgcHJvY2VzcyBmYWlscywgcmVzdW1lIHN0YXRlIGZyb20gZXhpc3RpbmcgcmVjb3JkCiAgICAgICAgc2VsZi5yZXN1bWVfc3RhdGUoZW5kcG9pbnRfaWQpCgogICAgICAgICMgSGFuZGxlIGVycm9ycyBjb21pbmcgZnJvbSBzdHJlYW0KICAgICAgICBmb3VuZF9lcnJvcnMgPSBzZWxmLmhhbmRsZV9lcnJvcnMoZW5kcG9pbnRfaWQsIGV2ZW50KQogICAgICAgIGlmIGZvdW5kX2Vycm9yczoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgIyBWYWxpZGF0ZSBldmVudCBmaWVsZHMKICAgICAgICBtb2RlbF9jbGFzcyA9IGV2ZW50LmdldCgibW9kZWxfY2xhc3MiKSBvciBldmVudC5nZXQoImNsYXNzIikKICAgICAgICB0aW1lc3RhbXAgPSBldmVudC5nZXQoIndoZW4iKQogICAgICAgIHJlcXVlc3RfaWQgPSBldmVudC5nZXQoInJlcXVlc3QiLCB7fSkuZ2V0KCJpZCIpCiAgICAgICAgbGF0ZW5jeSA9IGV2ZW50LmdldCgibWljcm9zZWMiKQogICAgICAgIGZlYXR1cmVzID0gZXZlbnQuZ2V0KCJyZXF1ZXN0Iiwge30pLmdldCgiaW5wdXRzIikKICAgICAgICBwcmVkaWN0aW9ucyA9IGV2ZW50LmdldCgicmVzcCIsIHt9KS5nZXQoIm91dHB1dHMiKQoKICAgICAgICBpZiBub3Qgc2VsZi5pc192YWxpZChpc19ub3Rfbm9uZSwgdGltZXN0YW1wLCBbIndoZW4iXSk6CiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgIGlmIGVuZHBvaW50X2lkIG5vdCBpbiBzZWxmLmZpcnN0X3JlcXVlc3Q6CiAgICAgICAgICAgIHNlbGYuZmlyc3RfcmVxdWVzdFtlbmRwb2ludF9pZF0gPSB0aW1lc3RhbXAKICAgICAgICBzZWxmLmxhc3RfcmVxdWVzdFtlbmRwb2ludF9pZF0gPSB0aW1lc3RhbXAKCiAgICAgICAgaWYgbm90IHNlbGYuaXNfdmFsaWQoaXNfbm90X25vbmUsIHJlcXVlc3RfaWQsIFsicmVxdWVzdCIsICJpZCJdKToKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICBpZiBub3Qgc2VsZi5pc192YWxpZChpc19ub3Rfbm9uZSwgbGF0ZW5jeSwgWyJtaWNyb3NlYyJdKToKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICBpZiBub3Qgc2VsZi5pc192YWxpZChpc19ub3Rfbm9uZSwgZmVhdHVyZXMsIFsicmVxdWVzdCIsICJpbnB1dHMiXSk6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgaWYgbm90IHNlbGYuaXNfdmFsaWQoaXNfbm90X25vbmUsIHByZWRpY3Rpb25zLCBbInJlc3AiLCAib3V0cHV0cyJdKToKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgdW5wYWNrZWRfbGFiZWxzID0ge2YiX3trfSI6IHYgZm9yIGssIHYgaW4gZXZlbnQuZ2V0KExBQkVMUywge30pLml0ZW1zKCl9CgogICAgICAgICMgU2VwYXJhdGUgZWFjaCBtb2RlbCBpbnZvY2F0aW9uIGludG8gc3ViIGV2ZW50cwogICAgICAgIGV2ZW50cyA9IFtdCiAgICAgICAgZm9yIGksIChmZWF0dXJlLCBwcmVkaWN0aW9uKSBpbiBlbnVtZXJhdGUoemlwKGZlYXR1cmVzLCBwcmVkaWN0aW9ucykpOgogICAgICAgICAgICBpZiBub3Qgc2VsZi5pc192YWxpZCgKICAgICAgICAgICAgICAgIGlzX2xpc3Rfb2ZfbnVtZXJpY3MsIGZlYXR1cmUsIFsicmVxdWVzdCIsICJpbnB1dHMiLCBmIlt7aX1dIl0KICAgICAgICAgICAgKToKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShwcmVkaWN0aW9uLCBsaXN0KToKICAgICAgICAgICAgICAgIHByZWRpY3Rpb24gPSBbcHJlZGljdGlvbl0KCiAgICAgICAgICAgIGV2ZW50cy5hcHBlbmQoCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgRlVOQ1RJT05fVVJJOiBmdW5jdGlvbl91cmksCiAgICAgICAgICAgICAgICAgICAgTU9ERUw6IHZlcnNpb25lZF9tb2RlbCwKICAgICAgICAgICAgICAgICAgICBNT0RFTF9DTEFTUzogbW9kZWxfY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgVElNRVNUQU1QOiB0aW1lc3RhbXAsCiAgICAgICAgICAgICAgICAgICAgRU5EUE9JTlRfSUQ6IGVuZHBvaW50X2lkLAogICAgICAgICAgICAgICAgICAgIFJFUVVFU1RfSUQ6IHJlcXVlc3RfaWQsCiAgICAgICAgICAgICAgICAgICAgTEFURU5DWTogbGF0ZW5jeSwKICAgICAgICAgICAgICAgICAgICBGRUFUVVJFUzogZmVhdHVyZSwKICAgICAgICAgICAgICAgICAgICBQUkVESUNUSU9OOiBwcmVkaWN0aW9uLAogICAgICAgICAgICAgICAgICAgIEZJUlNUX1JFUVVFU1Q6IHNlbGYuZmlyc3RfcmVxdWVzdFtlbmRwb2ludF9pZF0sCiAgICAgICAgICAgICAgICAgICAgTEFTVF9SRVFVRVNUOiBzZWxmLmxhc3RfcmVxdWVzdFtlbmRwb2ludF9pZF0sCiAgICAgICAgICAgICAgICAgICAgRVJST1JfQ09VTlQ6IHNlbGYuZXJyb3JfY291bnRbZW5kcG9pbnRfaWRdLAogICAgICAgICAgICAgICAgICAgIExBQkVMUzogZXZlbnQuZ2V0KExBQkVMUywge30pLAogICAgICAgICAgICAgICAgICAgIE1FVFJJQ1M6IGV2ZW50LmdldChNRVRSSUNTLCB7fSksCiAgICAgICAgICAgICAgICAgICAgRU5USVRJRVM6IGV2ZW50LmdldCgicmVxdWVzdCIsIHt9KS5nZXQoRU5USVRJRVMsIHt9KSwKICAgICAgICAgICAgICAgICAgICBVTlBBQ0tFRF9MQUJFTFM6IHVucGFja2VkX2xhYmVscywKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgIHJldHVybiBldmVudHMKCiAgICBkZWYgcmVzdW1lX3N0YXRlKHNlbGYsIGVuZHBvaW50X2lkKToKICAgICAgICAjIE1ha2Ugc3VyZSBwcm9jZXNzIGlzIHJlc3VtYWJsZSwgaWYgcHJvY2VzcyBmYWlscyBmb3IgYW55IHJlYXNvbiwgYmUgYWJsZSB0byBwaWNrIHRoaW5ncyB1cCBjbG9zZSB0byB3aGVyZSB3ZQogICAgICAgICMgbGVmdCB0aGVtCiAgICAgICAgaWYgZW5kcG9pbnRfaWQgbm90IGluIHNlbGYuZW5kcG9pbnRzOgogICAgICAgICAgICBsb2dnZXIuaW5mbygiVHJ5aW5nIHRvIHJlc3VtZSBzdGF0ZSIsIGVuZHBvaW50X2lkPWVuZHBvaW50X2lkKQogICAgICAgICAgICBlbmRwb2ludF9yZWNvcmQgPSBnZXRfZW5kcG9pbnRfcmVjb3JkKAogICAgICAgICAgICAgICAga3ZfY29udGFpbmVyPXNlbGYua3ZfY29udGFpbmVyLAogICAgICAgICAgICAgICAga3ZfcGF0aD1zZWxmLmt2X3BhdGgsCiAgICAgICAgICAgICAgICBlbmRwb2ludF9pZD1lbmRwb2ludF9pZCwKICAgICAgICAgICAgKQogICAgICAgICAgICBpZiBlbmRwb2ludF9yZWNvcmQ6CiAgICAgICAgICAgICAgICBmaXJzdF9yZXF1ZXN0ID0gZW5kcG9pbnRfcmVjb3JkLmdldChGSVJTVF9SRVFVRVNUKQogICAgICAgICAgICAgICAgaWYgZmlyc3RfcmVxdWVzdDoKICAgICAgICAgICAgICAgICAgICBzZWxmLmZpcnN0X3JlcXVlc3RbZW5kcG9pbnRfaWRdID0gZmlyc3RfcmVxdWVzdAogICAgICAgICAgICAgICAgZXJyb3JfY291bnQgPSBlbmRwb2ludF9yZWNvcmQuZ2V0KEVSUk9SX0NPVU5UKQogICAgICAgICAgICAgICAgaWYgZXJyb3JfY291bnQ6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5lcnJvcl9jb3VudFtlbmRwb2ludF9pZF0gPSBlcnJvcl9jb3VudAogICAgICAgICAgICBzZWxmLmVuZHBvaW50cy5hZGQoZW5kcG9pbnRfaWQpCgogICAgZGVmIGlzX3ZhbGlkKHNlbGYsIHZhbGlkYXRpb25fZnVuY3Rpb24sIGZpZWxkOiBBbnksIGRpY3RfcGF0aDogTGlzdFtzdHJdKToKICAgICAgICBpZiB2YWxpZGF0aW9uX2Z1bmN0aW9uKGZpZWxkLCBkaWN0X3BhdGgpOgogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIHNlbGYuZXJyb3JfY291bnQgKz0gMQogICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBoYW5kbGVfZXJyb3JzKHNlbGYsIGVuZHBvaW50X2lkLCBldmVudCkgLT4gYm9vbDoKICAgICAgICBpZiAiZXJyb3IiIGluIGV2ZW50OgogICAgICAgICAgICBzZWxmLmVycm9yX2NvdW50ICs9IDEKICAgICAgICAgICAgcmV0dXJuIFRydWUKCiAgICAgICAgcmV0dXJuIEZhbHNlCgoKZGVmIGVucmljaF9ldmVuX2RldGFpbHMoZXZlbnQpIC0+IE9wdGlvbmFsW2RpY3RdOgogICAgZnVuY3Rpb25fdXJpID0gZXZlbnQuZ2V0KEZVTkNUSU9OX1VSSSkKCiAgICBpZiBub3QgaXNfbm90X25vbmUoZnVuY3Rpb25fdXJpLCBbRlVOQ1RJT05fVVJJXSk6CiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBtb2RlbCA9IGV2ZW50LmdldChNT0RFTCkKICAgIGlmIG5vdCBpc19ub3Rfbm9uZShtb2RlbCwgW01PREVMXSk6CiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICB2ZXJzaW9uID0gZXZlbnQuZ2V0KFZFUlNJT04pCiAgICB2ZXJzaW9uZWRfbW9kZWwgPSBmInttb2RlbH06e3ZlcnNpb259IiBpZiB2ZXJzaW9uIGVsc2UgbW9kZWwKCiAgICBlbmRwb2ludF9pZCA9IGNyZWF0ZV9tb2RlbF9lbmRwb2ludF9pZCgKICAgICAgICBmdW5jdGlvbl91cmk9ZnVuY3Rpb25fdXJpLCB2ZXJzaW9uZWRfbW9kZWw9dmVyc2lvbmVkX21vZGVsLAogICAgKQoKICAgIGVuZHBvaW50X2lkID0gc3RyKGVuZHBvaW50X2lkKQoKICAgIGV2ZW50W1ZFUlNJT05FRF9NT0RFTF0gPSB2ZXJzaW9uZWRfbW9kZWwKICAgIGV2ZW50W0VORFBPSU5UX0lEXSA9IGVuZHBvaW50X2lkCgogICAgcmV0dXJuIGV2ZW50CgoKZGVmIGlzX25vdF9ub25lKGZpZWxkOiBBbnksIGRpY3RfcGF0aDogTGlzdFtzdHJdKToKICAgIGlmIGZpZWxkIGlzIG5vdCBOb25lOgogICAgICAgIHJldHVybiBUcnVlCiAgICBsb2dnZXIuZXJyb3IoCiAgICAgICAgZiJFeHBlY3RlZCBldmVudCBmaWVsZCBpcyBtaXNzaW5nOiB7ZmllbGR9IFtFdmVudCAtPiB7Jycuam9pbihkaWN0X3BhdGgpfV0iCiAgICApCiAgICByZXR1cm4gRmFsc2UKCgpkZWYgaXNfbGlzdF9vZl9udW1lcmljcygKICAgIGZpZWxkOiBMaXN0W1VuaW9uW2ludCwgZmxvYXQsIGRpY3QsIGxpc3RdXSwgZGljdF9wYXRoOiBMaXN0W3N0cl0KKToKICAgIGlmIGFsbChpc2luc3RhbmNlKHgsIGludCkgb3IgaXNpbnN0YW5jZSh4LCBmbG9hdCkgZm9yIHggaW4gZmllbGQpOgogICAgICAgIHJldHVybiBUcnVlCiAgICBsb2dnZXIuZXJyb3IoCiAgICAgICAgZiJFeHBlY3RlZCBldmVudCBmaWVsZCBpcyBtaXNzaW5nOiB7ZmllbGR9IFtFdmVudCAtPiB7Jycuam9pbihkaWN0X3BhdGgpfV0iCiAgICApCiAgICByZXR1cm4gRmFsc2UKCgpjbGFzcyBGaWx0ZXJOb3ROb25lKEZpbHRlcik6CiAgICBkZWYgX19pbml0X18oc2VsZiwgKiprd2FyZ3MpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oZm49bGFtYmRhIGV2ZW50OiBldmVudCBpcyBub3QgTm9uZSwgKiprd2FyZ3MpCgoKY2xhc3MgRmlsdGVyS2V5cyhNYXBDbGFzcyk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCoqa3dhcmdzKQogICAgICAgIHNlbGYua2V5cyA9IGxpc3QoYXJncykKCiAgICBkZWYgZG8oc2VsZiwgZXZlbnQpOgogICAgICAgIG5ld19ldmVudCA9IHt9CiAgICAgICAgZm9yIGtleSBpbiBzZWxmLmtleXM6CiAgICAgICAgICAgIGlmIGtleSBpbiBldmVudDoKICAgICAgICAgICAgICAgIG5ld19ldmVudFtrZXldID0gZXZlbnRba2V5XQoKICAgICAgICByZXR1cm4gbmV3X2V2ZW50IGlmIG5ld19ldmVudCBlbHNlIE5vbmUKCgpjbGFzcyBVbnBhY2tWYWx1ZXMoTWFwQ2xhc3MpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsICphcmdzLCAqKmt3YXJncyk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygqKmt3YXJncykKICAgICAgICBzZWxmLmtleXNfdG9fdW5wYWNrID0gc2V0KGFyZ3MpCgogICAgZGVmIGRvKHNlbGYsIGV2ZW50KToKICAgICAgICB1bnBhY2tlZCA9IHt9CiAgICAgICAgZm9yIGtleSBpbiBldmVudC5rZXlzKCk6CiAgICAgICAgICAgIGlmIGtleSBpbiBzZWxmLmtleXNfdG9fdW5wYWNrOgogICAgICAgICAgICAgICAgdW5wYWNrZWQgPSB7Kip1bnBhY2tlZCwgKipldmVudFtrZXldfQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgdW5wYWNrZWRba2V5XSA9IGV2ZW50W2tleV0KICAgICAgICByZXR1cm4gdW5wYWNrZWQKCgpjbGFzcyBNYXBGZWF0dXJlTmFtZXMoTWFwQ2xhc3MpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGt2X2NvbnRhaW5lcjogc3RyLCBrdl9wYXRoOiBzdHIsICoqa3dhcmdzKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCoqa3dhcmdzKQogICAgICAgIHNlbGYua3ZfY29udGFpbmVyID0ga3ZfY29udGFpbmVyCiAgICAgICAgc2VsZi5rdl9wYXRoID0ga3ZfcGF0aAogICAgICAgIHNlbGYuZmVhdHVyZV9uYW1lcyA9IHt9CiAgICAgICAgc2VsZi5sYWJlbF9jb2x1bW5zID0ge30KCiAgICBkZWYgZG8oc2VsZiwgZXZlbnQ6IERpY3QpOgogICAgICAgIGVuZHBvaW50X2lkID0gZXZlbnRbRU5EUE9JTlRfSURdCgogICAgICAgIGlmIGVuZHBvaW50X2lkIG5vdCBpbiBzZWxmLmZlYXR1cmVfbmFtZXM6CiAgICAgICAgICAgIGVuZHBvaW50X3JlY29yZCA9IGdldF9lbmRwb2ludF9yZWNvcmQoCiAgICAgICAgICAgICAgICBrdl9jb250YWluZXI9c2VsZi5rdl9jb250YWluZXIsCiAgICAgICAgICAgICAgICBrdl9wYXRoPXNlbGYua3ZfcGF0aCwKICAgICAgICAgICAgICAgIGVuZHBvaW50X2lkPWVuZHBvaW50X2lkLAogICAgICAgICAgICApCiAgICAgICAgICAgIGZlYXR1cmVfbmFtZXMgPSBlbmRwb2ludF9yZWNvcmQuZ2V0KEZFQVRVUkVfTkFNRVMpCiAgICAgICAgICAgIGZlYXR1cmVfbmFtZXMgPSBqc29uLmxvYWRzKGZlYXR1cmVfbmFtZXMpIGlmIGZlYXR1cmVfbmFtZXMgZWxzZSBOb25lCgogICAgICAgICAgICBsYWJlbF9jb2x1bW5zID0gZW5kcG9pbnRfcmVjb3JkLmdldChMQUJFTF9DT0xVTU5TKQogICAgICAgICAgICBsYWJlbF9jb2x1bW5zID0ganNvbi5sb2FkcyhsYWJlbF9jb2x1bW5zKSBpZiBsYWJlbF9jb2x1bW5zIGVsc2UgTm9uZQoKICAgICAgICAgICAgaWYgbm90IGZlYXR1cmVfbmFtZXM6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybigKICAgICAgICAgICAgICAgICAgICBmIkZlYXR1cmUgbmFtZXMgYXJlIG5vdCBpbml0aWFsaXplZCwgdGhleSB3aWxsIGJlIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkIiwKICAgICAgICAgICAgICAgICAgICBlbmRwb2ludF9pZD1lbmRwb2ludF9pZCwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGZlYXR1cmVfbmFtZXMgPSBbZiJme2l9IiBmb3IgaSwgXyBpbiBlbnVtZXJhdGUoZXZlbnRbRkVBVFVSRVNdKV0KICAgICAgICAgICAgICAgIGdldF92M2lvX2NsaWVudCgpLmt2LnVwZGF0ZSgKICAgICAgICAgICAgICAgICAgICBjb250YWluZXI9c2VsZi5rdl9jb250YWluZXIsCiAgICAgICAgICAgICAgICAgICAgdGFibGVfcGF0aD1zZWxmLmt2X3BhdGgsCiAgICAgICAgICAgICAgICAgICAga2V5PWV2ZW50W0VORFBPSU5UX0lEXSwKICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzPXtGRUFUVVJFX05BTUVTOiBqc29uLmR1bXBzKGZlYXR1cmVfbmFtZXMpfSwKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgIGlmIG5vdCBsYWJlbF9jb2x1bW5zOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm4oCiAgICAgICAgICAgICAgICAgICAgZiJsYWJlbCBjb2x1bW4gbmFtZXMgYXJlIG5vdCBpbml0aWFsaXplZCwgdGhleSB3aWxsIGJlIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkIiwKICAgICAgICAgICAgICAgICAgICBlbmRwb2ludF9pZD1lbmRwb2ludF9pZCwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGxhYmVsX2NvbHVtbnMgPSBbZiJwe2l9IiBmb3IgaSwgXyBpbiBlbnVtZXJhdGUoZXZlbnRbUFJFRElDVElPTl0pXQogICAgICAgICAgICAgICAgZ2V0X3YzaW9fY2xpZW50KCkua3YudXBkYXRlKAogICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcj1zZWxmLmt2X2NvbnRhaW5lciwKICAgICAgICAgICAgICAgICAgICB0YWJsZV9wYXRoPXNlbGYua3ZfcGF0aCwKICAgICAgICAgICAgICAgICAgICBrZXk9ZXZlbnRbRU5EUE9JTlRfSURdLAogICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM9e0xBQkVMX0NPTFVNTlM6IGpzb24uZHVtcHMobGFiZWxfY29sdW1ucyl9LAogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgc2VsZi5sYWJlbF9jb2x1bW5zW2VuZHBvaW50X2lkXSA9IGxhYmVsX2NvbHVtbnMKICAgICAgICAgICAgc2VsZi5mZWF0dXJlX25hbWVzW2VuZHBvaW50X2lkXSA9IGZlYXR1cmVfbmFtZXMKCiAgICAgICAgZmVhdHVyZV9uYW1lcyA9IHNlbGYuZmVhdHVyZV9uYW1lc1tlbmRwb2ludF9pZF0KICAgICAgICBmZWF0dXJlcyA9IGV2ZW50W0ZFQVRVUkVTXQogICAgICAgIGV2ZW50W05BTUVEX0ZFQVRVUkVTXSA9IHsKICAgICAgICAgICAgbmFtZTogZmVhdHVyZSBmb3IgbmFtZSwgZmVhdHVyZSBpbiB6aXAoZmVhdHVyZV9uYW1lcywgZmVhdHVyZXMpCiAgICAgICAgfQoKICAgICAgICBsYWJlbF9jb2x1bW5zID0gc2VsZi5sYWJlbF9jb2x1bW5zW2VuZHBvaW50X2lkXQogICAgICAgIHByZWRpY3Rpb24gPSBldmVudFtQUkVESUNUSU9OXQogICAgICAgIGV2ZW50W05BTUVEX1BSRURJQ1RJT05TXSA9IHsKICAgICAgICAgICAgbmFtZTogcHJlZGljdGlvbiBmb3IgbmFtZSwgcHJlZGljdGlvbiBpbiB6aXAobGFiZWxfY29sdW1ucywgcHJlZGljdGlvbikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGV2ZW50CgoKY2xhc3MgV3JpdGVUb0tWKE1hcENsYXNzKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjb250YWluZXI6IHN0ciwgdGFibGU6IHN0ciwgKiprd2FyZ3MpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKiprd2FyZ3MpCiAgICAgICAgc2VsZi5jb250YWluZXIgPSBjb250YWluZXIKICAgICAgICBzZWxmLnRhYmxlID0gdGFibGUKCiAgICBkZWYgZG8oc2VsZiwgZXZlbnQ6IERpY3QpOgogICAgICAgIGdldF92M2lvX2NsaWVudCgpLmt2LnVwZGF0ZSgKICAgICAgICAgICAgY29udGFpbmVyPXNlbGYuY29udGFpbmVyLAogICAgICAgICAgICB0YWJsZV9wYXRoPXNlbGYudGFibGUsCiAgICAgICAgICAgIGtleT1ldmVudFtFTkRQT0lOVF9JRF0sCiAgICAgICAgICAgIGF0dHJpYnV0ZXM9ZXZlbnQsCiAgICAgICAgKQogICAgICAgIHJldHVybiBldmVudAoKCmNsYXNzIEluZmVyU2NoZW1hKE1hcENsYXNzKToKICAgIGRlZiBfX2luaXRfXygKICAgICAgICBzZWxmLAogICAgICAgIHYzaW9fYWNjZXNzX2tleTogc3RyLAogICAgICAgIHYzaW9fZnJhbWVzZDogc3RyLAogICAgICAgIGNvbnRhaW5lcjogc3RyLAogICAgICAgIHRhYmxlOiBzdHIsCiAgICAgICAgKiprd2FyZ3MsCiAgICApOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKiprd2FyZ3MpCiAgICAgICAgc2VsZi5jb250YWluZXIgPSBjb250YWluZXIKICAgICAgICBzZWxmLnYzaW9fYWNjZXNzX2tleSA9IHYzaW9fYWNjZXNzX2tleQogICAgICAgIHNlbGYudjNpb19mcmFtZXNkID0gdjNpb19mcmFtZXNkCiAgICAgICAgc2VsZi50YWJsZSA9IHRhYmxlCiAgICAgICAgc2VsZi5rZXlzID0gc2V0KCkKCiAgICBkZWYgZG8oc2VsZiwgZXZlbnQ6IERpY3QpOgogICAgICAgIGtleV9zZXQgPSBzZXQoZXZlbnQua2V5cygpKQogICAgICAgIGlmIG5vdCBrZXlfc2V0Lmlzc3Vic2V0KHNlbGYua2V5cyk6CiAgICAgICAgICAgIHNlbGYua2V5cy51cGRhdGUoa2V5X3NldCkKICAgICAgICAgICAgZ2V0X2ZyYW1lc19jbGllbnQoCiAgICAgICAgICAgICAgICB0b2tlbj1zZWxmLnYzaW9fYWNjZXNzX2tleSwKICAgICAgICAgICAgICAgIGNvbnRhaW5lcj1zZWxmLmNvbnRhaW5lciwKICAgICAgICAgICAgICAgIGFkZHJlc3M9c2VsZi52M2lvX2ZyYW1lc2QsCiAgICAgICAgICAgICkuZXhlY3V0ZShiYWNrZW5kPSJrdiIsIHRhYmxlPXNlbGYudGFibGUsIGNvbW1hbmQ9ImluZmVyX3NjaGVtYSIpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKAogICAgICAgICAgICAgICAgIkZvdW5kIG5ldyBrZXlzLCBpbmZlcnJlZCBzY2hlbWEiLCB0YWJsZT1zZWxmLnRhYmxlLCBldmVudD1ldmVudAogICAgICAgICAgICApCiAgICAgICAgcmV0dXJuIGV2ZW50CgoKZGVmIGdldF9lbmRwb2ludF9yZWNvcmQoCiAgICBrdl9jb250YWluZXI6IHN0ciwga3ZfcGF0aDogc3RyLCBlbmRwb2ludF9pZDogc3RyCikgLT4gT3B0aW9uYWxbZGljdF06CiAgICBsb2dnZXIuaW5mbygKICAgICAgICBmIkdyYWJiaW5nIGVuZHBvaW50IGRhdGEiLCBlbmRwb2ludF9pZD1lbmRwb2ludF9pZCwgdGFibGVfcGF0aD1rdl9wYXRoLAogICAgKQogICAgdHJ5OgogICAgICAgIGVuZHBvaW50X3JlY29yZCA9ICgKICAgICAgICAgICAgZ2V0X3YzaW9fY2xpZW50KCkKICAgICAgICAgICAgLmt2LmdldChjb250YWluZXI9a3ZfY29udGFpbmVyLCB0YWJsZV9wYXRoPWt2X3BhdGgsIGtleT1lbmRwb2ludF9pZCwpCiAgICAgICAgICAgIC5vdXRwdXQuaXRlbQogICAgICAgICkKICAgICAgICByZXR1cm4gZW5kcG9pbnRfcmVjb3JkCiAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgIHJldHVybiBOb25lCgoKZGVmIGluaXRfY29udGV4dChjb250ZXh0OiBNTENsaWVudEN0eCk6CiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCJJbml0aWFsaXppbmcgRXZlbnRTdHJlYW1Qcm9jZXNzb3IiKQogICAgcGFyYW1ldGVycyA9IGVudmlyb24uZ2V0KCJNT0RFTF9NT05JVE9SSU5HX1BBUkFNRVRFUlMiKQogICAgcGFyYW1ldGVycyA9IGpzb24ubG9hZHMocGFyYW1ldGVycykgaWYgcGFyYW1ldGVycyBlbHNlIHt9CiAgICBzdHJlYW1fcHJvY2Vzc29yID0gRXZlbnRTdHJlYW1Qcm9jZXNzb3IoKipwYXJhbWV0ZXJzKQogICAgc2V0YXR0cihjb250ZXh0LCAic3RyZWFtX3Byb2Nlc3NvciIsIHN0cmVhbV9wcm9jZXNzb3IpCgoKZGVmIGhhbmRsZXIoY29udGV4dDogTUxDbGllbnRDdHgsIGV2ZW50OiBFdmVudCk6CiAgICBldmVudF9ib2R5ID0ganNvbi5sb2FkcyhldmVudC5ib2R5KQogICAgY29udGV4dC5sb2dnZXIuaW5mbyhldmVudF9ib2R5KQogICAgY29udGV4dC5zdHJlYW1fcHJvY2Vzc29yLmNvbnN1bWUoZXZlbnRfYm9keSkK
    commands: []
    code_origin: https://github.com/Michaelliv/functions.git#b6d661b4f8ad3f3a632a5024f679a4babbb04395:/home/michaell/projects/functions/model_monitoring_stream/model_monitoring_stream.py
  default_handler: handler
verbose: false
